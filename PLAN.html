
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PLAN</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
        h1, h2, h3, h4, h5, h6 { color: #333; margin-top: 20px; }
        code { background-color: #f4f4f4; padding: 2px 4px; border-radius: 3px; font-family: Consolas, monospace; }
        pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        blockquote { border-left: 4px solid #ddd; margin: 0; padding-left: 20px; color: #666; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
    </style>
</head>
<body>
<h1 id="laravel-viteexception-fix-plan">Laravel ViteException Fix Plan</h1>
<h2 id="notes">Notes</h2>
<ul>
<li>Admin User Management list &amp; create views implemented; routes and store method working.</li>
<li>Lawyer My Cases table view implemented with filters and action buttons.</li>
<li>Lawyer New Case Entry dynamic form implemented.</li>
<li>Supervisor dashboard enhanced with appeals card, recent lawyer updates list, and approval queue alert.</li>
<li>Supervisor All Cases master table with filters implemented.</li>
<li>Supervisor Case Approvals page with approval modal implemented; progress updates count displayed in listings.</li>
<li>Supervisor Closed Cases table with performance chart implemented.</li>
<li>Admin requested expanded Admin views (dashboard summary, user management enhancements, full case registry, reports, settings, audit logs).</li>
<li>Admin dashboard summary cards &amp; new cases graph in place.</li>
<li>Admin User Management controller updated with role filter, edit, update &amp; destroy methods; views pending.</li>
<li>Admin User index now counts assigned cases and role filter applied; create view added.</li>
<li>Main layout refactored to Blade with reactive collapsible sidebar and new header using Lucide icons.</li>
<li>Reusable UI components <code>StatCard</code> and <code>CaseTable</code> created with Tailwind &amp; Lucide.</li>
<li>Dashboards updated to use new <code>StatCard</code> component across Admin, Supervisor, and Lawyer views.</li>
<li>CaseDetailController created to serve detailed case view endpoint.</li>
<li>Requirement received to build Case Detail page with summary, progress timeline, add-progress modal, and supervisor approval workflow.</li>
<li>ProgressUpdate model, migration, controller &amp; routes scaffolded; ProgressTimeline component created; supervisor closure approval logic added.</li>
<li>Case Detail Blade page with summary, timeline, add-progress modal, and supervisor approval modal implemented.</li>
<li>Role-based dashboard redirect &amp; sidebar logic updated to support Spatie roles and "system administrator".</li>
<li>Migration added to create <code>role</code> column on users table to resolve SQL missing column error.</li>
<li>Database error surfaced: <code>approved_at</code> (and related financial fields) columns missing on <code>case_files</code>; schema must be updated to match code.</li>
<li>Missing columns migration created and database migrated successfully.</li>
<li>Admin dashboard graph query rewritten to satisfy ONLY_FULL_GROUP_BY mode.</li>
<li>Another missing column error (<code>execution_opened_at</code>) detected; <code>case_files</code> schema still incomplete.</li>
<li>Migration for <code>execution_opened_at</code> column created; needs to be migrated.</li>
<li>New error: <code>description</code> column missing on <code>progress_updates</code>; schema and code out of sync.</li>
<li>Replaced all <code>description</code> references in progress updates with existing <code>notes</code> column; no migration required.</li>
<li>Fixed <code>user_id</code> missing column error by updating <code>ProgressUpdate</code> relationship to use <code>updated_by</code> and adjusting dashboard queries.</li>
<li>Created <code>resources/views/supervisor/cases/reports.blade.php</code> (basic stats, chart, table) to resolve missing view error.</li>
<li>New error: <code>advisory_requested_at</code> column missing on <code>case_files</code>; migration created but pending.</li>
<li>Created <code>resources/views/supervisor/cases/advisory.blade.php</code> (listing advisory requests) to resolve missing view error.</li>
<li>Created <code>resources/views/admin/cases/index.blade.php</code> (All Cases registry view) to resolve missing view error.</li>
<li>Admin <code>CaseController</code> created with index &amp; show methods supplying <code>$branches</code>; undefined variable error fixed.</li>
<li>Admin Cases index page renders; further features pending.</li>
<li>Admin cases routes registered in <code>routes/web.php</code>; page accessible under Admin â†’ All Cases.</li>
<li>Branch model and migration scaffolded via <code>php artisan make:model Branch -m</code>; schema defined with essential fields (name, code, contact info); ready for migration.</li>
<li>Branch model created; seeding with initial data pending.</li>
<li>Branch migration schema updated (name, code, address, contacts, soft deletes).</li>
<li>Branch model enhanced with fillable fields and soft deletes; admin view fallback added; debug logging in Admin CaseController.</li>
<li>BranchSeeder created, registered, and executed successfully; <code>$branches</code> variable now available in view.</li>
<li>Admin CaseController updated and <code>$cases</code> variable now defined; error resolved by adding eager loading to controller method.</li>
<li>Added null-safe checks for cases/branches in admin cases index view.</li>
<li>Branch migration schema updated (name, code, address, contacts, soft deletes).</li>
<li>Added note: Admin Cases index page now correctly displays case data.</li>
<li>FatalError: Duplicate <code>branch()</code> method detected in <code>CaseFile</code> model; must remove duplicate to resolve redeclare error.</li>
<li>Duplicate <code>branch()</code> method removed from <code>CaseFile</code> model; redeclare error resolved.</li>
<li>Sidebar link updated to <code>admin.cases.index</code>; RouteNotFoundException resolved.</li>
</ul>
<h2 id="task-list">Task List</h2>
<ul>
<li>[x] Locate existing CSS file(s) in project.</li>
<li>[x] Edit <code>vite.config.js</code> to add <code>resources/css/app.css</code> to inputs.</li>
<li>[x] Run <code>npm install</code> (ensure deps present).</li>
<li>[x] Execute <code>npm run build</code> (or <code>npm run dev</code>) to regenerate manifest.</li>
<li>[x] Clear Laravel caches with <code>php artisan optimize:clear</code>.</li>
<li>[x] Reload page and confirm the ViteException is gone.</li>
<li>[x] Report results / commit changes.</li>
<li>[x] Run <code>php artisan route:list</code> to verify <code>/dashboard</code> route exists.</li>
<li>[x] Inspect <code>routes/web.php</code> and controllers to ensure dashboard route defined.</li>
<li>[x] Re-run <code>npm run build</code> to include new base path.</li>
<li>[x] Remove <code>auth</code> middleware from <code>/dashboard</code> route.</li>
<li>[x] Update <code>ProtectedRoute.jsx</code> with token fallback logic.</li>
<li>[x] Create <code>Api/AuthController.php</code> for token-based login.</li>
<li>[x] Register POST <code>/api/login</code> route in <code>routes/api.php</code>.</li>
<li>[x] Create <code>welcome.blade.php</code> view to satisfy Breeze installer.</li>
<li>[x] Run <code>php artisan breeze:install blade</code> (Blade scaffolding installed).</li>
<li>[x] Compile Breeze assets (<code>npm install &amp;&amp; npm run build</code>).</li>
<li><strong>SPA-specific tasks removed (Blade auth working, React being purged).</strong></li>
<li>[x] Remove React/Vite plugin from config &amp; packages.</li>
<li>[x] Delete unused React source directories.</li>
<li>[x] Install Blade scaffolding (Laravel Breeze/UI) as baseline.</li>
<li>[x] Run <code>npm install</code> to prune node_modules.</li>
<li>[x] <code>composer remove inertiajs/inertia-laravel</code> and clear caches.</li>
<li>[x] Build detailed Lawyer dashboard view (stats &amp; timeline).</li>
<li>[x] Add Lawyer CaseController and routes (cases list &amp; create, progress, advisory).</li>
<li>[x] Scaffold placeholder view <code>resources/views/lawyer/cases/index.blade.php</code>.</li>
<li>[x] Create shared sidebar (Blade component) and dashboard card component.</li>
<li>[x] Integrate sidebar into main layout.</li>
<li>[x] Refactor <code>layouts/app.blade.php</code> with reactive sidebar &amp; header components.</li>
<li>[x] Enhance sidebar with Lucide icons and mobile collapse behaviour.</li>
<li>[x] Ensure controllers supply dashboard data to Admin &amp; Supervisor dashboards.</li>
<li>[x] Update controllers/routes to return Blade views.</li>
<li>[x] Build detailed Admin dashboard view.</li>
<li>[x] Build detailed Supervisor dashboard view.</li>
<li>[x] Fix layout flex structure so dashboards display correctly.</li>
<li>[x] Build detailed Lawyer dashboard cards &amp; timeline.</li>
<li>[x] Build Lawyer My Cases table with filters.</li>
<li>[x] Build Lawyer New Case Entry dynamic form.</li>
<li>[x] Create reusable <code>StatCard</code> component for dashboard summaries.</li>
<li>[x] Create reusable <code>CaseTable</code> component with filters, search &amp; pagination.</li>
<li>[x] Replace dashboard cards with new <code>x-ui.stat-card</code> components.</li>
<li>[ ] Integrate <code>x-ui.case-table</code> into case listing pages (lawyer, supervisor, admin).</li>
<li>[ ] Test authentication and dashboard navigation.</li>
<li>[ ] Clean up unused SPA code &amp; dependencies.</li>
<li>[ ] Remove <code>App\Http\Middleware\HandleInertiaRequests.php</code> (optional; class already neutralized).</li>
<li>[ ] Search &amp; delete any remaining <code>Inertia\</code> references.</li>
<li>[ ] Clear caches (<code>php artisan optimize:clear</code>) and retest dashboards.</li>
<li>[x] Extend supervisor sidebar (All Cases, Case Approvals, Closed Cases, Reports, Advisory Reviews).</li>
<li>[x] Add stats: Cases Pending Closure, Execution Files Opened, Supervisor Actions.</li>
<li>[x] Implement modal &amp; routes for early-closure approval workflow.</li>
<li>[x] Extend admin sidebar (Dashboard, User Management, All Cases, Reports, System Settings, Audit Logs).</li>
<li>[x] Add total system stats &amp; role count cards to admin dashboard.</li>
<li>[x] Implement admin users index listing.</li>
<li>[x] Add create user view &amp; store method.</li>
<li>[ ] Complete update/delete user functionality.</li>
<li>[ ] Audit logs view &amp; model.</li>
<li>[x] Admin dashboard summary cards &amp; new cases graph.</li>
<li>[ ] Enhance Admin User Management (edit, deactivate, role filter, modal add user &amp; branch assignment).</li>
<li>[ ] Build Admin All Cases registry with edit/delete and export.</li>
<li>[x] Create Admin Cases index Blade view.</li>
<li>[x] Update Admin CaseController index method to supply <code>$branches</code> list and fix undefined variable.</li>
<li>[x] Register admin cases routes (index, show) in <code>routes/web.php</code>.</li>
<li>[x] Debug undefined <code>$cases</code> variable on admin cases index</li>
<li>[x] Remove duplicate <code>branch()</code> method in <code>CaseFile</code> model and retest</li>
<li>[x] Fix missing <code>admin.cases</code> named route or update view links</li>
<li>[x] Build Supervisor All Cases master table with filters.</li>
<li>[x] Build Supervisor Case Approvals page with approval modal.</li>
<li>[x] Build Supervisor Closed Cases table &amp; performance chart.</li>
<li>[x] Build Supervisor Reports page (type &amp; frequency filters, export).</li>
<li>[x] Build Supervisor Advisory Reviews table with approval modal.</li>
<li>[x] Build Supervisor Advisory Requests table.</li>
<li>[x] Create route <code>/cases/{case}</code> mapped to <code>CaseDetailController</code>.</li>
<li>[x] Generate <code>CaseDetailController</code> to load case data.</li>
<li>[x] Build Case Detail page (<code>cases/show.blade.php</code>) with summary, progress timeline, add progress modal, supervisor panel.</li>
<li>[x] Create <code>ProgressTimeline</code> Blade component with vertical layout.</li>
<li>[x] Create <code>ProgressUpdate</code> model, migration, and store logic.</li>
<li>[x] Implement Add Progress modal (status, notes, file upload) &amp; save under current user.</li>
<li>[x] Add authorization checks for assigned lawyer and supervisor actions.</li>
<li>[x] Implement Supervisor "Approve Case Closure" modal &amp; route.</li>
<li>[x] Add role-based dashboard redirect &amp; sidebar components wired.</li>
<li>[x] Create migration to add <code>role</code> column to users table.</li>
<li>[x] Add migration to append <code>approved_at</code>, <code>closure_requested_at</code>, <code>claimed_amount</code>, <code>recovered_amount</code> columns to <code>case_files</code> table.</li>
<li>[x] Run <code>php artisan migrate</code> and verify dashboards &amp; counts.</li>
<li>[x] Create migration to append <code>execution_opened_at</code> column to <code>case_files</code> table.</li>
<li>[x] Refactor progress updates to use existing <code>notes</code> column (no new DB column).</li>
<li>[x] Update <code>ProgressUpdate</code> model to reference <code>updated_by</code> FK and adjust queries.</li>
<li>[x] Scaffold Supervisor Reports view to resolve missing view error.</li>
<li>[x] Create migration to add <code>advisory_requested_at</code> column to <code>case_files</code> table.</li>
<li>[ ] Run migrations for <code>execution_opened_at</code> and <code>advisory_requested_at</code> and verify counts.</li>
<li>[ ] Update models/controllers to cast &amp; use new datetime/money fields.</li>
<li>[x] Create Branch model and migration.</li>
<li>[x] Run migration for branches table schema.</li>
<li>[x] Create BranchSeeder and register in DatabaseSeeder.</li>
<li>[x] Seed Branch model with initial data.</li>
</ul>
<h2 id="current-goal">Current Goal</h2>
<p>Integrate <code>x-ui.case-table</code> component into listings</p>
</body>
</html>



